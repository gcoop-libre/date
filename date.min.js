function date_field_formatter_view(a,b,c,d,e,f,g){try{console.log("ITEMS",f);var h={},i=g.type;if("date_default"==i){var j=null;if(drupalgap.date_formats[g.settings.format_type]){var k=drupalgap.date_formats[g.settings.format_type];$.each(k,function(a,b){return k=b,!1}),j=k.format}else j=drupalgap.date_types[g.settings.format_type].format;j=date_format_cleanse(j,d.settings.granularity),$.each(f,function(a,b){var c="undefined"!=typeof b.value2,d=c?"From: ":"",e=date_prepare(b.value);if(console.log("d",e),h[a]={markup:'<div class="value">'+d+date(j,e.getTime())+"</div>"},c){var f=date_prepare(b.value2);console.log("d2",f),h[a].markup+='<div class="value2">To: '+date(j,f.getTime())+"</div>"}})}else if("format_interval"==i){var l=g.settings.interval,m=g.settings.interval_display,n=new Date;$.each(f,function(a,b){var c=date_prepare(b.value);if("time ago"==m||"raw time ago"==m){var d=drupalgap_format_interval((n.getTime()-c.getTime())/1e3,l);"time ago"==m&&(d+=" "+t("ago")),h[a]={markup:d}}else console.log("WARNING: date_field_formatter_view - unsupported interval_display ("+m+")")})}else console.log("WARNING: date_field_formatter_view - unsupported type ("+i+")");return h}catch(o){console.log("date_field_formatter_view - "+o)}}function date_field_widget_form(a,b,c,d,e,f,g,h){try{console.log(c),console.log(d),console.log(f),console.log(h),f[g].type="hidden";var i=c.settings.todate,j=parseInt(d.widget.settings.increment),k=new Date;k.setMinutes(_date_minute_increment_adjust(j,k.getMinutes()));var l=!0,m=!0;if("undefined"!=typeof f[g].value&&""!=f[g].value||(l=!1),"undefined"!=typeof f[g].item&&"undefined"!=typeof f[g].item.value2&&""!=f[g].item.value2||(m=!1),l||""!=f[g].default_value&&f[g].default_value||""==d.settings.default_value||(f[g].default_value=d.settings.default_value),m||""!=f[g].default_value2&&f[g].default_value2||""==d.settings.default_value2||(f[g].default_value2=d.settings.default_value2),!l&&""!=f[g].default_value)switch(f[g].default_value){case"now":var n=date_yyyy_mm_dd_hh_mm_ss(date_yyyy_mm_dd_hh_mm_ss_parts(k));f[g].value=n,f[g].default_value=n;break;case"blank":f[g].value="",f[g].default_value="";break;default:console.log("WARNING: date_field_widget_form() - unsupported default value: "+f[g].default_value)}if(!m&&""!=f[g].default_value2)switch(f[g].default_value2){case"same":var n=date_yyyy_mm_dd_hh_mm_ss(date_yyyy_mm_dd_hh_mm_ss_parts(k));f[g].value2=n,f[g].default_value2=n,empty(f[g].value)||(f[g].value+="|"),f[g].value+=f[g].value2,empty(f[g].default_value)||(f[g].default_value+="|"),f[g].default_value+=f[g].default_value2;break;case"blank":f[g].value2="",f[g].default_value2="";break;default:console.log("WARNING: date_field_widget_form() - unsupported default value 2: "+f[g].default_value2)}m&&-1==f[g].value.indexOf("|")&&(f[g].value+="|"+f[g].item.value2,f[g].attributes||(f[g].attributes={}),f[g].attributes.value=f[g].value);var o=new Date,p=["value"];if(empty(i)||p.push("value2"),$.each(p,function(a,b){var e=_date_get_item_and_offset(f,g,b,l,m),h=e.item_date,k=e.offset,n=date_military(d),p=null,q=null,r=null,s=null,u=null,v=null,w=null;if($.each(c.settings.granularity,function(a,c){if(c){var e=f[g].id;"value2"==b&&(e+="2"),e+="-"+a;var i={id:e,onchange:"date_select_onchange(this, '"+f[g].id+"', '"+a+"', "+n+", "+j+", "+k+")"};switch(a){case"year":p=_date_grain_widget_year(o,d,i,l,m,h);break;case"month":q=_date_grain_widget_month(o,d,i,l,m,h);break;case"day":r=_date_grain_widget_day(o,d,i,l,m,h);break;case"hour":s=_date_grain_widget_hour(o,d,i,l,m,h,n),n||(w={type:"select",attributes:{id:i.id.replace(a,"ampm"),onclick:i.onchange.replace(a,"ampm")},value:parseInt(h.getHours())<12?"am":"pm",options:{am:"am",pm:"pm"}});break;case"minute":u=_date_grain_widget_minute(o,d,i,l,m,h,b,j);break;default:console.log("WARNING: date_field_widget_form() - unsupported grain! ("+a+")")}}}),!empty(i)){var x="value2"!=b?t("From"):t("To");f[g].children.push({markup:theme("header",{text:x+": "})})}_date_grain_widgets_ux_wrap(f,g,p,q,r,s,u,v,w)}),date_tz_handling_is_date(c)){var q={};$.each(drupalgap.time_zones,function(a,b){q[b]=b});var r={type:"select",options:q,title:t("Timezone"),attributes:{id:f[g].id+"-timezone"}};l&&f[g].item.timezone?r.value=f[g].item.timezone:!l&&c.settings.timezone_db&&(r.value=c.settings.timezone_db),f[g].children.push(r)}}catch(s){console.log("date_field_widget_form - "+s)}}function date_tz_handling_is_date(a){return a.settings.tz_handling&&"date"==a.settings.tz_handling&&drupalgap.time_zones}function _date_grain_widget_year(a,b,c,d,e,f){try{var g=parseInt(a.getFullYear()),h=b.widget.settings.year_range,i=h.split(":"),j=i[0],k=!0;-1==j.indexOf("-")&&-1==j.indexOf("+")||(k=!1),k?j=parseInt(j):(-1!=j.indexOf("+")&&(j=j.replace("+","")),j=parseInt(j)+g),j||(j=g);var l=i[1],m=!0;-1==l.indexOf("-")&&-1==l.indexOf("+")||(m=!1),m?l=parseInt(l):(-1!=l.indexOf("+")&&(l=l.replace("+","")),l=parseInt(l)+g),l||(l=g);for(var n={},o=j;l>=o;o++)n[o]=o;return d&&(g=parseInt(f.getFullYear())),{prefix:theme("date_label",{title:t("Year")}),type:"date_select",value:g,attributes:c,options:n}}catch(p){console.log("_date_grain_widget_year",p)}}function _date_grain_widget_month(a,b,c,d,e,f){try{for(var g=parseInt(a.getMonth())+1,h={},i=1;12>=i;i++)h[i]=""+i;return d&&(g=parseInt(f.getMonth())+1),{prefix:theme("date_label",{title:t("Month")}),type:"date_select",value:g,attributes:c,options:h}}catch(j){console.log("_date_grain_widget_month",j)}}function _date_grain_widget_day(a,b,c,d,e,f){try{for(var g=parseInt(a.getDate()),h={},i=1;31>=i;i++)h[i]=""+i;return d&&(g=parseInt(f.getDate())),{prefix:theme("date_label",{title:t("Day")}),type:"date_select",value:g,attributes:c,options:h}}catch(j){console.log("_date_grain_widget_day",j)}}function _date_grain_widget_hour(a,b,c,d,e,f,g){try{for(var h=parseInt(a.getHours()),i={},j=g?23:12,k=g?0:1,l=k;j>=l;l++)i[l]=""+l;return d&&(h=parseInt(f.getHours()),g||(h>12?h-=12:0===h&&(h=12))),{prefix:theme("date_label",{title:t("Hour")}),type:"date_select",value:h,attributes:c,options:i}}catch(m){console.log("_date_grain_widget_hour",m)}}function _date_grain_widget_minute(a,b,c,d,e,f,g,h){try{for(var i=parseInt(a.getMinutes()),j={},k=0;59>=k;k+=h){var l=""+k;1==l.length&&(l="0"+l),j[k]=l}return d&&"value"==g?i=parseInt(f.getMinutes()):e&&"value2"==g&&(i=parseInt(f.getMinutes())),1!=h&&(i=_date_minute_increment_adjust(h,i)),{prefix:theme("date_label",{title:t("Minute")}),type:"date_select",value:i,attributes:c,options:j}}catch(m){console.log("_date_grain_widget_minute",m)}}function _date_grain_widget_second(a,b,c,d,e){try{}catch(f){console.log("_date_grain_widget_second",f)}}function _date_grain_widgets_ux_wrap(a,b,c,d,e,f,g,h,i){try{var j=null;if(d&&!e?j="ui-grid-a":d&&e&&(j="ui-grid-b"),j&&a[b].children.push({markup:'<div class="'+j+'">'}),c&&(j&&(c.prefix='<div class="ui-block-a">'+c.prefix,c.suffix="</div>"),a[b].children.push(c)),d&&(j&&(d.prefix='<div class="ui-block-b">'+d.prefix,d.suffix="</div>"),a[b].children.push(d)),e){if(j){var k=d?"ui-block-c":"ui-block-b";e.prefix='<div class="'+k+'">'+e.prefix,e.suffix="</div>"}a[b].children.push(e)}j&&a[b].children.push({markup:"</div>"});var l=null;if(f&&g&&!h?l="ui-grid-a":g&&h&&(l="ui-grid-b"),l&&a[b].children.push({markup:'<div class="'+l+'">'}),f&&(l&&(f.prefix='<div class="ui-block-a">'+f.prefix,f.suffix="</div>"),a[b].children.push(f)),g){if(l){var k="ui-block-a";f&&(k="ui-block-b"),g.prefix='<div class="'+k+'">'+g.prefix,g.suffix="</div>"}a[b].children.push(g)}h&&a[b].children.push(h),i&&a[b].children.push(i),j&&a[b].children.push({markup:"</div>"})}catch(m){console.log("_date_grain_widgets_ux_wrap",m)}}function date_prepare(a,b){try{date_apple_device()&&(a=date_apple_cleanse(a));var c=a.replace(/-/g,"/");if(date_apple_device()){var d=c.split(/[^0-9]/),e=new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5]);return e}return new Date(Date.parse(c))}catch(f){console.log("date_prepare() - "+f)}}function date_apple_device(){return"undefined"!=typeof device&&"iOS"==device.platform||navigator.vendor&&navigator.vendor.indexOf("Apple")>-1}function date_apple_cleanse(a){return a.replace(/ /g,"T")}function date_military(a){var b=!0;return!a.widget.settings.input_format||-1==a.widget.settings.input_format.indexOf("g")&&-1==a.widget.settings.input_format.indexOf("h")||(b=!1),b}function date_select_onchange(a,b,c,d,e,f){try{var g=-1!=$(a).attr("id").indexOf("value2"),h=$("#"+b).val(),i=-1!=h.indexOf("|"),j=[];i?j=h.split("|"):j.push(h),console.log("parts before",j);var k=null;h?(!g&&empty(j[0])&&(j[0]=date_yyyy_mm_dd_hh_mm_ss()),date_apple_device()&&(g?i&&(j[1]=date_apple_cleanse(j[1])):j[0]=date_apple_cleanse(j[0])),k=g?i?new Date(j[1]):new Date:new Date(j[0]),date_apple_device()&&f&&(k=date_item_adjust_offset(k,f))):k=new Date,console.log("parts after",j);var l=$(a).val();switch(console.log(c),c){case"year":k.setYear(l);break;case"month":k.setMonth(l-1);break;case"day":k.setDate(l);break;case"hour":if(d)k.setHours(l);else{l=parseInt(l);var m=$("#"+$(a).attr("id").replace(c,"ampm")),n=$(m).val();switch(n){case"am":12==l&&(l=0),k.setHours(l);break;case"pm":12==l&&(l=0),k.setHours(l+12)}}break;case"minute":k.setMinutes(l);break;case"ampm":"pm"==l?k.getHours()<12?k.setHours(k.getHours()+12):k.setHours(k.getHours()):"am"==l&&k.setHours(k.getHours()-12)}console.log("before",k),k.setMinutes(_date_minute_increment_adjust(e,k.getMinutes())),console.log("after",k);var o=date_yyyy_mm_dd_hh_mm_ss(date_yyyy_mm_dd_hh_mm_ss_parts(k));g?j[1]=o:j[0]=o,console.log("value",o,k,j),$("#"+b).val(j.join("|"))}catch(p){drupalgap_error(p)}}function _date_minute_increment_adjust(a,b){try{switch(a){case 5:5>b?b=0:10>b?b=5:15>b?b=10:20>b?b=15:25>b?b=20:30>b?b=25:35>b?b=30:40>b?b=35:45>b?b=40:50>b?b=45:55>b?b=50:60>b&&(b=55);break;case 10:10>b?b=0:20>b?b=10:30>b?b=20:40>b?b=30:50>b?b=40:60>b&&(b=50);break;case 15:15>b?b=0:30>b?b=15:45>b?b=30:60>b&&(b=45);break;case 30:30>b?b=0:60>b&&(b=30)}return b}catch(c){console.log("_date_minute_increment_adjust - "+c)}}function date_format_cleanse(a,b){for(grain in b)if(b.hasOwnProperty(grain)){var c=b[grain];if(!c){var d=[];switch(grain){case"year":d=["L","o","Y","y"];break;case"month":d=["F","m","M","n","t"];break;case"day":d=["d","D","j","l","L","N","S","w","z"];break;case"hour":d=[" - ","g:","G:","h:","H:","g","G","h","H"];break;case"minute":d=["i:","i"];break;case"second":d=["s"]}if(d.length)for(var e=0;e<d.length;e++){var f=d[e];a=a.replace(f,"")}}}return a}function date_item_adjust_offset(a,b){return a=new Date(a.toUTCString()),a=a.getTime()/1e3,a-=parseInt(b),new Date(1e3*a)}function _date_get_item_and_offset(a,b,c,d,e){try{var f=null,g=null;if(d&&"value"==c){if(-1!=a[b].value.indexOf("|")){var h=a[b].value.split("|");f=new Date(date_apple_device()?date_apple_cleanse(h[0]):h[0])}else f=new Date(date_apple_device()?date_apple_cleanse(a[b].value):a[b].value);a[b].item&&a[b].item.offset&&(g=a[b].item.offset)}return e&&"value2"==c&&(f=new Date(date_apple_device()?date_apple_cleanse(a[b].item.value2):a[b].item.value2),a[b].item&&a[b].item.offset2&&(g=a[b].item.offset2)),d||e||f||(f=new Date),date_apple_device()&&g&&(f=date_item_adjust_offset(f,g)),{item_date:f,offset:g}}catch(i){console.log("_date_get_item_and_offset",i)}}function date_services_request_pre_postprocess_alter(a,b){"system"==a.service&&"connect"==a.resource&&b.time_zones&&(drupalgap.time_zones=b.time_zones)}function date_assemble_form_state_into_field(a,b,c,d,e,f,g,h,i){try{console.log("assemble",arguments),h.use_delta=!1;var j=d.settings.todate;date_apple_device()&&(c=date_apple_cleanse(c));var k={},l=["value"];return empty(j)||l.push("value2"),$.each(l,function(a,b){k[b]={};var h=-1!=c.indexOf("|"),j=[];if(h?j=c.split("|"):j.push(c),date_tz_handling_is_date(d)){var l={timezone:$("#"+i.elements[d.field_name][f][g].id+"-timezone").val()};d.settings.timezone_db&&(l.timezone_db=d.settings.timezone_db),k.timezone=l}$.each(d.settings.granularity,function(a,c){var h=null;if("value"==b){h=new Date(j[0]);var l=parseInt(i.elements[d.field_name][f][g].item.offset);l&&(k.offset=l),date_apple_device()&&l&&(h=new Date(h.toUTCString()),h=h.getTime()/1e3,h-=parseInt(l),h=new Date(1e3*h))}else if("value2"==b){h=new Date(j[1]);var m=parseInt(i.elements[d.field_name][f][g].item.offset2);m&&(k.offset2=m),date_apple_device()&&m&&(h=new Date(h.toUTCString()),h=h.getTime()/1e3,h-=parseInt(m),h=new Date(1e3*h))}if(c)switch(a){case"year":k[b].year=h.getFullYear();break;case"month":k[b].month=parseInt(h.getMonth())+1;break;case"day":k[b].day=parseInt(h.getDate());break;case"hour":k[b].hour=parseInt(h.getHours()),date_military(e)||k[b].hour>=12&&(k[b].hour=k[b].hour%12,k[b].ampm="pm");break;case"minute":k[b].minute=""+parseInt(h.getMinutes()),1==k[b].minute.length&&(k[b].minute="0"+k[b].minute)}})}),console.log("RESULT",k),k}catch(m){console.log("date_assemble_form_state_into_field - "+m)}}function theme_datetime(a){try{var b="";a.attributes.type="hidden",b+="<input "+drupalgap_attributes(a.attributes)+"/>";var c=a.field_info_instance.widget.type,d="theme_"+c;if(drupalgap_function_exists(d)){var e=window[d];b+=e.call(null,a)}else{var f="WARNING: theme_datetime() - unsupported widget type! ("+c+")";console.log(f)}return b}catch(g){console.log("theme_datetime - "+g)}}function theme_date_select(a){try{return theme("select",a)}catch(b){console.log("theme_date_select - "+b)}}function theme_date_label(a){try{return"<div "+drupalgap_attributes(a.attributes)+"><strong>"+a.title+"</strong></div>"}catch(b){console.log("theme_date_label - "+b)}}